<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    
    
    
    
    
    
    
    
    
    
    <link rel="alternate" href="/atom.xml" title="喵's StackHarbor" type="application/atom+xml" />
    
    
    <link rel="stylesheet" type="text/css" href="/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="/css/index.css">
    
    <link rel="stylesheet" type="text/css" href="/css/sidebar.css">
    
    
<link rel="stylesheet" type="text/css" href="/css/page.css">
<link rel="stylesheet" type="text/css" href="/css/post.css">

    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <link rel="stylesheet" type="text/css" href="/css/undefined.css">
    <link rel="stylesheet" type="text/css" href="/css/lightgallery.min.css">
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script defer type="text/javascript" src="/js/util.js"></script>
    <script defer type="text/javascript" src="/js/clipboard.min.js"></script>
    <script defer type="text/javascript" src="/js/scrollspy.js"></script>
    <script defer type="text/javascript" src="/js/fontawesome-all.min.js"></script>
    <script defer type="text/javascript" src="/js/lightgallery.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-fullscreen.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-hash.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-pager.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-thumbnail.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-zoom.min.js"></script>
    
    
    
    <script defer type="text/javascript" src="/js/index.js"></script>
    <script type="text/javascript">
    $(document).ready(function () {
      $(".post pre code figure.highlight").each(function (i, e) {
        var lang = e.parentNode.className;
        $(e).before([
          "<div class=\"code-titlebar\">",
            "<div class=\"titlebar-left\">",
              "<a class=\"copy\"><i class=\"far fa-copy\"></i></a>",
            "</div>",
            "<div class=\"titlebar-center\">",
              lang.length ? lang.toUpperCase() : "代码",
            "</div>",
            "<div class=\"titlebar-right\">",
              "<button class=\"button-dot dot-minimize\"></button>",
              "<button class=\"button-dot dot-maximize\"></button>",
              "<button class=\"button-dot dot-close\"></button>",
            "</div>",
          "</div>"
        ].join(""));
        // $(e).before("<button class=\"copy button\">clipboard.copy</button>");
      });
      var cb = new ClipboardJS("a.copy", {
        "target": function (trigger) {
            // Get target element by DOM API.
            // trigger.parentNode.parentNode is code-titlebar.
            // nextElementSibling is figure.highlight, lastChild is pre.code.
            return trigger.parentNode.parentNode.nextElementSibling.lastChild;
        }
      });
      cb.on("success", function (e) {
        e.clearSelection();
        var trigger = e.trigger;
        // Change button text as a user tip.
        trigger.innerHTML = "<i class=\"far fa-check-square\"></i>";
        $(trigger).addClass("copied");
        // Change button text back;
        setTimeout(function () {
          trigger.innerHTML = "<i class=\"far fa-copy\"></i>";
          $(trigger).removeClass("copied");
        }, 1500);
      });
    });
    </script>
    
    <script defer type="text/javascript" src="/js/custom.js"></script>
    <title>使用 GDB 进行简单的 C 语言程序调试 | 喵's StackHarbor - Whisper to the World</title>
  </head>
  <body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN" data-spy="scroll" data-target=".list-group">
    
<header id="header" class="header">
  <div class="container">
    <div class="header-container">
      <div class="header-title">
        <h1 class="title"><a href="/">喵's StackHarbor</a></h1>
        <h2 class="subtitle">Whisper to the World</h2>
      </div>
      
    </div>
    <nav id="nav" class="nav">
      <a id="nav-toggle" class="nav-toggle" aria-hidden="true"><i class="fas fa-bars" aria-label="切换导航栏"></i></a>
      <ul id="menu" role="menubar" aria-hidden="false">
        
      </ul>
    </nav>
  </div>
</header>


    <main id="main" class="main">
      <div class="container">
        <div class="main-container">
          <div class="content">
            
<div id="post" class="page">
  <article class="article post card" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://sh.alynx.moe/posts/Using-Gdb/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Alynx Zhou">
        <meta itemprop="description" content="全ての存在は滅びるようにデザインされている">
        <meta itemprop="image" content="/">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="喵's StackHarbor">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">使用 GDB 进行简单的 C 语言程序调试</h1>
      <div class="post-meta">
        
        <span class="post-date meta-block">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2017-03-15T11:24:33.000Z">2017-03-15 周三 19:24:33 CST</time></span>
        </span>
        
        
        <span class="post-categories meta-block">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a></span><i class="fas fa-angle-right"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a></span><i class="fas fa-angle-right"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E7%BC%96%E7%A8%8B/C%20%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">C 语言</span></a></span>
        </span>
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      <p>事实证明有时候无聊的东西反而变成了一篇博文，谁叫恶趣味的C语言作业非要求用word写实验报告，本猹宁可先写成Markdown再复制粘贴过去。</p>
<a id="more"></a>

<p>首先按照惯例应该介绍下GDB，搭配GCC使用的调试器，也是众多使用GCC为编译器的IDE的默认调试器（大概？），虽然无聊的实验报告模板还很搞笑的写了一个部分叫XXX调试器和VC6.0的比较（看戏的内心：我看过两年学生出生时间比VC6还晚的时候这些课还怎么拿VC6讲）。</p>
<p>所以掌握GDB的使用还是很有必要的，毕竟掌握某个使用GDB的IDE终究只是掌握了一个图形壳子，原理估计还是要深入一层到直接用GDB（强行接入正经模式）。</p>
<p>这里只是按照实验报告的要求写一下断点调试和单步执行的用法（PS：Word实在是太难用了，字号缩进和标题序号就没有按照我想要的方式工作过。</p>
<hr>
<h1 id="准备"><a class="headerlink" href="/posts/Using-Gdb/#%E5%87%86%E5%A4%87" title="准备"></a>准备</h1>
<h2 id="调试模式编译程序"><a class="headerlink" href="/posts/Using-Gdb/#%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8F%E7%BC%96%E8%AF%91%E7%A8%8B%E5%BA%8F" title="调试模式编译程序"></a>调试模式编译程序</h2>
<p>首先应该明确调试的实现方式，GDB能够暂时的停下程序操作程序其实是通过向编译过程中的二进制流中添加钩子（HOOKS）来实现的。但是对于一个正常的，打算释出给用户使用的程序而言不应该以调试模式编译，因为这些添加进去的钩子不但会增大文件体积，还会降低程序的运行效率。所以GCC默认编译程序的时候时不会添加这个钩子的，需要的时候以<code>-g</code>参数来启用调试模式。</p>
<p>本例中以文件<a href="/posts/2017/03/15/Using-Gdb/Lab2.c">Lab2.c</a>为例，使用命令</p>
<pre><code><figure class="highlight hljs llvm"><pre class="gutter"><span class="line">1</span>
</pre><pre class="code"><code>$ gcc -std=<span class="hljs-keyword">c</span><span class="hljs-number">11</span> -g -o lab Lab<span class="hljs-number">2</span>.<span class="hljs-keyword">c</span></code></pre></figure></code></pre><p>将它编译到可执行文件lab。</p>
<h2 id="用GDB打开程序。"><a class="headerlink" href="/posts/Using-Gdb/#%E7%94%A8GDB%E6%89%93%E5%BC%80%E7%A8%8B%E5%BA%8F%E3%80%82" title="用GDB打开程序。"></a>用GDB打开程序。</h2>
<p>打开程序的命令很简单，就是<code>$ gdb lab</code>，但是有可能遇到的问题是程序要处理命令行参数，在使用GDB的时候是不能直接在命令行后面附加程序参数的，需要使用参数可以在打开GDB之后输入<code>set args 参数1 参数2 ...</code>附加上参数。</p>
<p>用GDB打开程序之后是一个交互界面，显示了一些信息和<code>(gdb)</code>这个提示符，表示你现在是在和GDB进行交互而不是程序。这个时候程序是不会运行的。</p>
<pre><code><figure class="highlight hljs sqf"><pre class="gutter"><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
</pre><pre class="code"><code>GNU gdb (GDB) <span class="hljs-number">7.12</span>.<span class="hljs-number">1</span>
Copyright (C) <span class="hljs-number">2017</span> Free Software Foundation, Inc.
License GPLv3+: GNU GPL version <span class="hljs-number">3</span> <span class="hljs-built_in">or</span> later &lt;http:<span class="hljs-comment">//gnu.org/licenses/gpl.html&gt;</span>
This is free software: you are free <span class="hljs-keyword">to</span> change <span class="hljs-built_in">and</span> redistribute it.
There is NO WARRANTY, <span class="hljs-keyword">to</span> the extent permitted by law.  <span class="hljs-built_in">Type</span> <span class="hljs-string">"show copying"</span>
<span class="hljs-built_in">and</span> <span class="hljs-string">"show warranty"</span> <span class="hljs-keyword">for</span> details.
This GDB was configured as <span class="hljs-string">"x86_64-pc-linux-gnu"</span>.
<span class="hljs-built_in">Type</span> <span class="hljs-string">"show configuration"</span> <span class="hljs-keyword">for</span> configuration details.
<span class="hljs-keyword">For</span> bug reporting instructions, please see:
&lt;http:<span class="hljs-comment">//www.gnu.org/software/gdb/bugs/&gt;.</span>
<span class="hljs-built_in">Find</span> the GDB manual <span class="hljs-built_in">and</span> other documentation <span class="hljs-built_in">resources</span> online at:
&lt;http:<span class="hljs-comment">//www.gnu.org/software/gdb/documentation/&gt;.</span>
<span class="hljs-keyword">For</span> help, <span class="hljs-built_in">type</span> <span class="hljs-string">"help"</span>.
<span class="hljs-built_in">Type</span> <span class="hljs-string">"apropos word"</span> <span class="hljs-keyword">to</span> search <span class="hljs-keyword">for</span> commands related <span class="hljs-keyword">to</span> <span class="hljs-string">"word"</span>...
Reading symbols <span class="hljs-keyword">from</span> lab...done.
(gdb)</code></pre></figure></code></pre><h1 id="调试"><a class="headerlink" href="/posts/Using-Gdb/#%E8%B0%83%E8%AF%95" title="调试"></a>调试</h1>
<h2 id="设置断点"><a class="headerlink" href="/posts/Using-Gdb/#%E8%AE%BE%E7%BD%AE%E6%96%AD%E7%82%B9" title="设置断点"></a>设置断点</h2>
<p>首先使用<code>break</code>指令就可以添加一个断点，断点顾名思义就是程序运行到这个位置会暂停下来交给GDB，这样你才能够在程序运行到一半的时候查看一些可疑的变量，断点是针对函数使用的，比如我想在所有的printf()进入的时候暂停，可以使用：</p>
<pre><code><figure class="highlight hljs cpp"><pre class="gutter"><span class="line">1</span>
</pre><pre class="code"><code>(gdb) <span class="hljs-keyword">break</span> <span class="hljs-built_in">printf</span></code></pre></figure></code></pre><p>显示的是这样的：</p>
<pre><code><figure class="highlight hljs maxima"><pre class="gutter"><span class="line">1</span>
<span class="line">2</span>
</pre><pre class="code"><code>(gdb) <span class="hljs-built_in">break</span> <span class="hljs-built_in">printf</span>
Breakpoint <span class="hljs-number">1</span> <span class="hljs-built_in">at</span> <span class="hljs-number">0x400540</span></code></pre></figure></code></pre><p>当然接下来可以继续添加更多的断点。</p>
<p>然后使用<code>run</code>就可以让程序跑起来：</p>
<pre><code><figure class="highlight hljs gradle"><pre class="gutter"><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
</pre><pre class="code"><code>(gdb) run
Starting program: <span class="hljs-regexp">/home/</span>alynx<span class="hljs-regexp">/Homework/</span>实验材料（学生版）<span class="hljs-regexp">/实验2/</span>lab
[实验<span class="hljs-number">2</span>说明]本练习运行一个三重<span class="hljs-keyword">for</span>循环, 循环结构如下:
<span class="hljs-keyword">int</span> <span class="hljs-keyword">count</span> = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; j&lt;LoopEnd1; i++)
{
    <span class="hljs-comment">//第一重循环体</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>; j&lt;LoopEnd2; j++)
    {
        <span class="hljs-comment">//第二重循环体</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> s=<span class="hljs-number">0</span>; s&lt;LoopEnd3; s++)
        {
            <span class="hljs-keyword">count</span>++;<span class="hljs-comment">//第三重循环体</span>
        }
    }
}

Breakpoint <span class="hljs-number">1</span>, <span class="hljs-number">0</span>x00007ffff7a86e00 in printf () <span class="hljs-keyword">from</span> <span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/libc.so.6</span></code></pre></figure></code></pre><p>这时候使用<code>print</code>指令可以打印任意的内容：</p>
<pre><code><figure class="highlight hljs routeros"><pre class="gutter"><span class="line">1</span>
<span class="line">2</span>
</pre><pre class="code"><code>(gdb) <span class="hljs-builtin-name">print</span> printf
<span class="hljs-variable">$1</span> = {&lt;text variable, <span class="hljs-literal">no</span> <span class="hljs-builtin-name">debug</span> info&gt;} 0x7ffff7a86e00 &lt;printf&gt;</code></pre></figure></code></pre><p>使用<code>bt</code>指令可以显示出程序的栈（Backtrace）：</p>
<pre><code><figure class="highlight hljs shell"><pre class="gutter"><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
</pre><pre class="code"><code>(gdb) bt
<span class="hljs-meta">#</span><span class="bash">0  0x00007ffff7a86e00 <span class="hljs-keyword">in</span> <span class="hljs-built_in">printf</span> () from /usr/lib/libc.so.6</span>
<span class="hljs-meta">#</span><span class="bash">1  0x0000000000400745 <span class="hljs-keyword">in</span> main (argc=1, argv=0x7fffffffe078) at Lab2.c:26</span></code></pre></figure></code></pre><p>输入<code>c</code>就是继续运行程序的意思。但是<code>step</code>指令的功能更加有用，顾名思义这个就是单步运行，每次只运行一行代码，这是个step-in的模式，即如果该行有函数则进入函数内一行一行运行，而<code>next</code>则是step-over的模式，即如果该行有函数会运行函数返回结果而不是进入函数内部。</p>
<pre><code><figure class="highlight hljs awk"><pre class="gutter"><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre><pre class="code"><code>(gdb) step
Single stepping until <span class="hljs-keyword">exit</span> from <span class="hljs-keyword">function</span> printf,
which has no line number information.
main (argc=<span class="hljs-number">1</span>, argv=<span class="hljs-number">0</span>x7fffffffe078) at Lab2.c:<span class="hljs-number">27</span>
<span class="hljs-number">27</span>        scanf(<span class="hljs-string">"%d"</span>, &amp;LoopEnd1);</code></pre></figure></code></pre><p>如果不输入指令直接回车，就是重复上一条指令，程序运行结束之后可以使用<code>quit</code>指令退出GDB。</p>
<hr>
<p>好了本猹要去补作业了。</p>
<p><em>Alynx Zhou</em></p>
<p><strong>A Coder &amp; Dreamer</strong></p>

    </main>
    <footer class="post-footer">
      
      <div class="post-tags">
        <a class="post-tag button" href="/tags/C%20%E8%AF%AD%E8%A8%80/" rel="tag"><i class="fas fa-tag"></i>C 语言</a>
      </div>
      
    </footer>
  </article>
  
  <nav class="page-nav">
    <div class="page-nav-next page-nav-item">
      
      <a href="/posts/Grey-Valentine-s-Day/" rel="next" title="灰色情人节"><i class="fas fa-angle-left"></i><span class="nav-title">灰色情人节</span></a>
      
    </div>
    <div class="page-nav-prev page-nav-item">
      
      <a href="/posts/Sister-s-Noise/" rel="prev" title="口琴曲谱：sister's noise"><span class="nav-title">口琴曲谱：sister's noise</span><i class="fas fa-angle-right"></i></a>
      
    </div>
  </nav>
  
  
  
</div>

          </div>
          
          
          
<aside class="sidebar" id="sidebar" style="background: url(/images/background.png);">
  
  
<div class="info sidebar-item" id="info">
  
  <h1 class="author-name">Alynx Zhou</h1>
  <h2 class="author-description">全ての存在は滅びるようにデザインされている</h2>
  <div class="site-count">
    
  </div>
  
  <div class="rss">
    <a class="rss-link button sidebar-item" href="/atom.xml"><i class="fas fa-rss"></i>RSS</a>
  </div>
  
</div>


  <div class="sidebar-sticky">
    
    
    <hr>
    <div class="post-toc sidebar-item" id="toc-div">
      <div><i class="fas fa-list-ol"></i>文章目录</div>
      <div class="post-toc-content">
        
        
        <ol class="list-group toc">
        
          <li>
            <a class="list-group-item toc-link" href="#准备">准备</a>
            
            
        <ol >
        
          <li>
            <a class="list-group-item toc-link" href="#调试模式编译程序">调试模式编译程序</a>
            
          </li>
        
          <li>
            <a class="list-group-item toc-link" href="#用GDB打开程序。">用GDB打开程序。</a>
            
          </li>
        
        </ol>
        
            
          </li>
        
          <li>
            <a class="list-group-item toc-link" href="#调试">调试</a>
            
            
        <ol >
        
          <li>
            <a class="list-group-item toc-link" href="#设置断点">设置断点</a>
            
          </li>
        
        </ol>
        
            
          </li>
        
        </ol>
        
      </div>
    </div>
    
    
    
    
  </div>
</aside>


          
        </div>
      </div>
    </main>
    
<footer id="footer" class="footer">
  <div class="container">
    <div class="back-to-top">
      <button id="back-to-top"><i class="fas fa-angle-double-up" aria-label="回到顶部"></i></button>
    </div>
    <div class="footer-container">
      <div class="footer-left">
        <div class="copyright">
          <span class="author"><i class="far fa-edit"></i>Alynx Zhou</span><span class="years"><i class="far fa-copyright"></i><span id="years-text"></span></span>
        </div>
        
      </div>
      <div class="footer-right">
        <div class="custom-info">
          
        </div>
        <div class="powered-by">
          由 <a href="https://github.com/AlynxZhou/hikaru/" target="_blank">Hikaru</a> 强力驱动<i class="fab fa-node-js"></i>主题 <a href="https://github.com/AlynxZhou/hikaru-theme-aria/" target="_blank">ARIA</a>
        </div>
      </div>
    </div>
  </div>
</footer>


  </body>
</html>
<!-- Page built by Hikaru v2.0.4 at 2019-08-15 周四 14:12:57 CST. -->
