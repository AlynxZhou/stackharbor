<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    
    
    
    
    
    
    
    
    
    
    <link rel="alternate" href="/atom.xml" title="喵's StackHarbor" type="application/atom+xml" />
    
    
    <link rel="stylesheet" type="text/css" href="/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="/css/index.css">
    
    <link rel="stylesheet" type="text/css" href="/css/sidebar.css">
    
    
<link rel="stylesheet" type="text/css" href="/css/page.css">
<link rel="stylesheet" type="text/css" href="/css/post.css">

    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <link rel="stylesheet" type="text/css" href="/css/undefined.css">
    <link rel="stylesheet" type="text/css" href="/css/lightgallery.min.css">
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script defer type="text/javascript" src="/js/util.js"></script>
    <script defer type="text/javascript" src="/js/clipboard.min.js"></script>
    <script defer type="text/javascript" src="/js/scrollspy.js"></script>
    <script defer type="text/javascript" src="/js/fontawesome-all.min.js"></script>
    <script defer type="text/javascript" src="/js/lightgallery.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-fullscreen.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-hash.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-pager.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-thumbnail.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-zoom.min.js"></script>
    
    
    
    <script defer type="text/javascript" src="/js/index.js"></script>
    <script type="text/javascript">
    $(document).ready(function () {
      $(".post pre code figure.highlight").each(function (i, e) {
        var lang = e.parentNode.className;
        $(e).before([
          "<div class=\"code-titlebar\">",
            "<div class=\"titlebar-left\">",
              "<a class=\"copy\"><i class=\"far fa-copy\"></i></a>",
            "</div>",
            "<div class=\"titlebar-center\">",
              lang.length ? lang.toUpperCase() : "代码",
            "</div>",
            "<div class=\"titlebar-right\">",
              "<button class=\"button-dot dot-minimize\"></button>",
              "<button class=\"button-dot dot-maximize\"></button>",
              "<button class=\"button-dot dot-close\"></button>",
            "</div>",
          "</div>"
        ].join(""));
        // $(e).before("<button class=\"copy button\">clipboard.copy</button>");
      });
      var cb = new ClipboardJS("a.copy", {
        "target": function (trigger) {
            // Get target element by DOM API.
            // trigger.parentNode.parentNode is code-titlebar.
            // nextElementSibling is figure.highlight, lastChild is pre.code.
            return trigger.parentNode.parentNode.nextElementSibling.lastChild;
        }
      });
      cb.on("success", function (e) {
        e.clearSelection();
        var trigger = e.trigger;
        // Change button text as a user tip.
        trigger.innerHTML = "<i class=\"far fa-check-square\"></i>";
        $(trigger).addClass("copied");
        // Change button text back;
        setTimeout(function () {
          trigger.innerHTML = "<i class=\"far fa-copy\"></i>";
          $(trigger).removeClass("copied");
        }, 1500);
      });
    });
    </script>
    
    <script defer type="text/javascript" src="/js/custom.js"></script>
    <title>会发说说报时的树莓派 | 喵's StackHarbor - Whisper to the World</title>
  </head>
  <body itemscope itemtype="http://schema.org/WebPage" lang="zh_CN" data-spy="scroll" data-target=".list-group">
    
<header id="header" class="header">
  <div class="container">
    <div class="header-container">
      <div class="header-title">
        <h1 class="title"><a href="/">喵's StackHarbor</a></h1>
        <h2 class="subtitle">Whisper to the World</h2>
      </div>
      
    </div>
    <nav id="nav" class="nav">
      <a id="nav-toggle" class="nav-toggle" aria-hidden="true"><i class="fas fa-bars" aria-label="切换导航栏"></i></a>
      <ul id="menu" role="menubar" aria-hidden="false">
        
      </ul>
    </nav>
  </div>
</header>


    <main id="main" class="main">
      <div class="container">
        <div class="main-container">
          <div class="content">
            
<div id="post" class="page">
  <article class="article post card" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://sh.alynx.moe/posts/RPi-QZone-Bot/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Alynx Zhou">
        <meta itemprop="description" content="全ての存在は滅びるようにデザインされている">
        <meta itemprop="image" content="/">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
        <meta itemprop="name" content="喵's StackHarbor">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">会发说说报时的树莓派</h1>
      <div class="post-meta">
        
        <span class="post-date meta-block">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2016-08-14T07:40:04.000Z">2016-08-14 周日 15:40:04 CST</time></span>
        </span>
        
        
        <span class="post-categories meta-block">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a></span><i class="fas fa-angle-right"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%A0%91%E8%8E%93%E6%B4%BE/" itemprop="url" rel="index"><span itemprop="name">树莓派</span></a></span><i class="fas fa-angle-right"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E6%A0%91%E8%8E%93%E6%B4%BE/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a></span>
        </span>
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      <p><strong>由于WebQQ的验证码机制更新，QQLib的作者已于2016年8月17日更新源代码，本页也随之更新！请之前使用过的朋友用<code># pip3 uninstall qqlib</code>卸载旧版，再重新安装最新版的QQLib，使用本页最新的Python脚本！</strong></p>
<hr>
<p>Hello，最近好久没有更新博客了，因为一直没有发现什么好玩的东西来写（其实就是因为懒）。那么前天终于发现了一个好东西，就是这个<a href="https://github.com/gera2ld/qqlib/" target="_blank">QQLib for Python</a>，可以通过Python在QQ空间发说说的库。</p>
<a id="more"></a>

<p>说到找这个东西的原因嘛……由于一些你懂得的原因，<a href="https://telegram.org/" target="_blank">Telegram</a>被封锁是日益严重啊。我以前写了个非常有用的<a href="https://github.com/Alynx/telebot/" target="_blank">TeleBot</a>跑在树莓派上，无奈身边用Telegram的人太少（<del>无法装X</del>），所以最开始想在树莓派上跑一个微信公众号来玩。然后发现微信的Api要求你指定一个域名，可是我树莓派跑在家里电信是不会白给我一个固定ip的（555……），为了解决这个问题我还特地造了个轮子，用Python自己封装了一个CloudXNS的Api用来定期ddns更新A记录，脚本写好了之后上网搜了一下发现有人说你在自己家里跑httpd被抓到是会被电信查水表的……虽然没有法律明文规定，但是就是这样，嗯，<del>这背后一定有肮脏的PY交易</del>（和谐）。于是微信公众号的计划就这样流产了……正好<a href="http://lgiki.xyz/" target="_blank">L Giki</a>说他和他的朋友实现了一个QQ的聊天机器人，然而他们是PHP党……而且实现方法很复杂，主要是腾讯丧心病狂的加密……还有webQQ协议已经被腾讯阉割的不成样子了。百般无奈之时发现了这个GitHub项目，本着有轮子就不要自己造的原则，我决定写一个定期发说说的程序运行在树莓派上，那就是这样。</p>
<p>老规矩，这个脚本不是很长，下面贴上来吧，它的名字叫做<code>qclock.py</code>（2016-08-17更新）：</p>
<pre><code class="Python"><figure class="highlight hljs python"><pre class="gutter"><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
<span class="line">41</span>
<span class="line">42</span>
<span class="line">43</span>
<span class="line">44</span>
<span class="line">45</span>
<span class="line">46</span>
<span class="line">47</span>
<span class="line">48</span>
<span class="line">49</span>
<span class="line">50</span>
<span class="line">51</span>
<span class="line">52</span>
<span class="line">53</span>
<span class="line">54</span>
<span class="line">55</span>
<span class="line">56</span>
<span class="line">57</span>
<span class="line">58</span>
<span class="line">59</span>
<span class="line">60</span>
<span class="line">61</span>
</pre><pre class="code"><code><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment">#-*- coding: utf-8 -*-</span>

<span class="hljs-comment">### Filename: qclock.py</span>
<span class="hljs-comment">## Created by Alynx Zhou</span>
<span class="hljs-comment"># alynxzhou@gmail.com, http://alynx.xyz/</span>

<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> qqlib
<span class="hljs-keyword">from</span> qqlib <span class="hljs-keyword">import</span> qzone

QQ_NUM = <span class="hljs-number">1234567890</span>
QQ_PASSWD = <span class="hljs-string">"MyPassWord."</span>

qz = qzone.QZone(QQ_NUM, QQ_PASSWD)

<span class="hljs-keyword">try</span>:
    qz.login()
<span class="hljs-keyword">except</span> qqlib.NeedVerifyCode <span class="hljs-keyword">as</span> nvc:
    <span class="hljs-comment"># Get a verify code.</span>
    verifier = nvc.verifier
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">"verify.jpg"</span>, <span class="hljs-string">"wb"</span>) <span class="hljs-keyword">as</span> verify_jpg:
        verify_jpg.write(verifier.image)
    print(<span class="hljs-string">"Saved verify photo to verify.jpg, please open it by yourself."</span>)
    vcode = input(<span class="hljs-string">"Enter verify code here: "</span>)
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># Test verify code.</span>
        kw = verifier.verify(vcode)
    <span class="hljs-keyword">except</span> qqlib.VerifyCodeError <span class="hljs-keyword">as</span> vce:
        os.remove(<span class="hljs-string">"verify.jpg"</span>)
        <span class="hljs-keyword">raise</span> vce(<span class="hljs-string">"Wrong verify code!"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># Finish login.</span>
        qz.login()
        os.remove(<span class="hljs-string">"verify.jpg"</span>)

print(<span class="hljs-string">"Login finished."</span>)

unit = <span class="hljs-string">"°C"</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_temp</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-comment"># Get internal CPU temperature.</span>
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">"/sys/class/thermal/thermal_zone0/temp"</span>) <span class="hljs-keyword">as</span> temp_open:
        temp = float(temp_open.read())/<span class="hljs-number">1000</span>
    <span class="hljs-keyword">return</span> temp

<span class="hljs-comment"># Loop to get time and feed to qzone.</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
        tm = time.localtime()
        <span class="hljs-keyword">if</span> tm.tm_min == <span class="hljs-number">0</span>:
            qz.feed(<span class="hljs-string">"树莓派自动报时：\n现在是%d年%d月%d日 %d时整。\nCPU温度为%.2f%s。"</span>%(tm.tm_year, tm.tm_mon, tm.tm_mday, tm.tm_hour, get_temp(), unit))
            print(<span class="hljs-string">"Feeded at %d-%.2d-%.d %.2d:%.2d."</span>%(tm.tm_year, tm.tm_mon, tm.tm_mday, tm.tm_hour, tm.tm_min))
        <span class="hljs-keyword">elif</span> tm.tm_min == <span class="hljs-number">30</span>:
            qz.feed(<span class="hljs-string">"树莓派自动报时：\n现在是%d年%d月%d日 %d时%d分。\nCPU温度为%.2f%s。"</span>%(tm.tm_year, tm.tm_mon, tm.tm_mday, tm.tm_hour, tm.tm_min, get_temp(), unit))
            print(<span class="hljs-string">"Feeded at %d-%.2d-%.d %.2d:%.2d."</span>%(tm.tm_year, tm.tm_mon, tm.tm_mday, tm.tm_hour, tm.tm_min))
        <span class="hljs-comment"># Use 60 to keep only one feed in the minute.</span>
        time.sleep(<span class="hljs-number">60</span>)
<span class="hljs-keyword">except</span> KeyboardInterrupt:
    exit()</code></pre></figure></code></pre>
<p>当然，下载链接在<a href="/posts/2016/08/14/RPi-QZone-Bot/qclock.py">这里</a>（2016-08-17更新）。</p>
<p>使用的时候先把<code>QQ_NUM</code>的值修改为你打算用来<del>装X</del>发说说的QQ号码，<code>QQ_PASSWD</code>的值则是你QQ的密码咯。这里建议各位不要使用自己用的QQ号做实验，而是另申请QQ号来作报时～不然谁知道腾讯哪天会不会找个什么理由关闭webQQ再冻结你的QQ号呢～</p>
<p>然后就是一句话的……不对！你还需要先安装QQLib啊，就像下面这样：</p>
<pre><code class="bash"><figure class="highlight hljs bash"><pre class="gutter"><span class="line">1</span>
</pre><pre class="code"><code><span class="hljs-comment"># pip3 install git+https://github.com/gera2ld/qqlib.git</span></code></pre></figure></code></pre>
<p>然后一句话运行起来：</p>
<pre><code class="bash"><figure class="highlight hljs bash"><pre class="gutter"><span class="line">1</span>
</pre><pre class="code"><code>$ python3 ./qclock.py</code></pre></figure></code></pre>
<p>保持它不要关闭，最好的办法还是<a href="https://www.gnu.org/software/screen/" target="_blank">GNU Screen</a>啊～</p>
<p>每到整点和半点你的树莓派就会自动发一条说说报时并附上当前的CPU温度～如果你想做更多的话完全可以自己扩展我这个脚本。记住那个<code>time.sleep(60)</code>的60不是随便能改的，一分钟一次的循环不会特别耗资源，如果你改小了间隔，可能会导致一分钟内它走了两次循环，发了两条说说。时间的精确度保持在分钟级别。</p>
<p>然后，我用来测试的QQ号是<code>3530795351</code>，这是它的<a href="http://user.qzone.qq.com/3530795351" target="_blank">QQ空间</a>，欢迎围观效果。</p>
<p>好啦，这个脚本就先介绍到这里了，我要去继续完善更多功能咯，首先还是要搞好我的Emacs，然后，我不是针对腾讯，我是说BAT这三个货都是辣鸡！</p>
<p><em>Alynx Zhou</em></p>
<p><strong>A Coder &amp; Dreamer</strong></p>

    </main>
    <footer class="post-footer">
      
      <div class="post-tags">
        <a class="post-tag button" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag"><i class="fas fa-tag"></i>树莓派</a><a class="post-tag button" href="/tags/Python/" rel="tag"><i class="fas fa-tag"></i>Python</a><a class="post-tag button" href="/tags/QQLib/" rel="tag"><i class="fas fa-tag"></i>QQLib</a>
      </div>
      
    </footer>
  </article>
  
  <nav class="page-nav">
    <div class="page-nav-next page-nav-item">
      
      <a href="/posts/BJTU-Life/" rel="next" title="生活在BJTU"><i class="fas fa-angle-left"></i><span class="nav-title">生活在BJTU</span></a>
      
    </div>
    <div class="page-nav-prev page-nav-item">
      
      <a href="/posts/Three-Years/" rel="prev" title="如果时光停滞三年"><span class="nav-title">如果时光停滞三年</span><i class="fas fa-angle-right"></i></a>
      
    </div>
  </nav>
  
  
  
</div>

          </div>
          
          
          
<aside class="sidebar" id="sidebar" style="background: url(/images/background.png);">
  
  
<div class="info sidebar-item" id="info">
  
  <h1 class="author-name">Alynx Zhou</h1>
  <h2 class="author-description">全ての存在は滅びるようにデザインされている</h2>
  <div class="site-count">
    
  </div>
  
  <div class="rss">
    <a class="rss-link button sidebar-item" href="/atom.xml"><i class="fas fa-rss"></i>RSS</a>
  </div>
  
</div>


  <div class="sidebar-sticky">
    
    
    
    
    
  </div>
</aside>


          
        </div>
      </div>
    </main>
    
<footer id="footer" class="footer">
  <div class="container">
    <div class="back-to-top">
      <button id="back-to-top"><i class="fas fa-angle-double-up" aria-label="回到顶部"></i></button>
    </div>
    <div class="footer-container">
      <div class="footer-left">
        <div class="copyright">
          <span class="author"><i class="far fa-edit"></i>Alynx Zhou</span><span class="years"><i class="far fa-copyright"></i><span id="years-text"></span></span>
        </div>
        
      </div>
      <div class="footer-right">
        <div class="custom-info">
          
        </div>
        <div class="powered-by">
          由 <a href="https://github.com/AlynxZhou/hikaru/" target="_blank">Hikaru</a> 强力驱动<i class="fab fa-node-js"></i>主题 <a href="https://github.com/AlynxZhou/hikaru-theme-aria/" target="_blank">ARIA</a>
        </div>
      </div>
    </div>
  </div>
</footer>


  </body>
</html>
<!-- Page built by Hikaru v2.0.4 at 2019-08-15 周四 14:12:57 CST. -->
